<app-editor-entity
  [entityName]="entityNameCompra"
  [setEntity]="SelectedCompraId"
  (saveEvent)="getMovimientos()"
  (deleteEvent)="getMovimientos()"
  (CancelEvent)="SelectedCompraId = null"
></app-editor-entity>

<ion-button color="success"    shape="round" size="small" (click)="isOpenModal=true" >
  <ion-icon  slot="start" name="plus" ></ion-icon>  
  <ion-label>Añadir venta</ion-label>        
</ion-button>

<add-venta [isOpen]="isOpenModal" (CancelEvent)="isOpenModal=false" ></add-venta>

<!-- <app-editor-entity #venta
  [entityName]="entityNameVenta"
  [setEntity]="SelectedVentaId"
  [entityInitialValues]="entityVentaInitialValues"
  (saveEvent)="getMovimientos()"
  (deleteEvent)="getMovimientos()"
  (CancelEvent)="SelectedVentaId = null"
></app-editor-entity> -->


<ion-grid class="router-outlet">
  <ion-row>
    <ion-col>
      <!-- <my-table
      [loadOnInit]="true"
        [canAddEntity] ="user.isAdmin"
        [canUpdateEntity] ="user.isAdmin"
        [title]="'Compra de Acciones'"
        [entityName]="entityName"
        [columns]="columns"
        [refresh]="tableRefresh"
      ></my-table> -->
      <!-- {{selectedNode | json}} -->

      <div *ngIf="isLoading">
        <app-base-cargando [message]="'Cargando operaciones...'"></app-base-cargando>
      </div>

      <div *ngFor="let mov of movimientos" class="grid ">
        <div class="col-12 itemTreeCompra">
          <div class="grid head">
            <div class="col-4 hand name-date"  (click)="SelectedCompraId = mov?.id">
              <div class="text-top font-bold">{{ mov.descripcion }}</div>
              <div>{{ mov.fecha | date: 'dd/MM/yy' }}</div>
            </div>
            
            <div class="col-3"  (click)="selectedNode = selectedNode == mov ?  null : mov">
              <div class="text-center precio-total">
                <span class="precio">{{ mov.precio }} €</span>
                <span class="total">{{ mov.total }} €</span>
              </div>
            </div>

            <div class="col-3">
              <div class="text-center">                
                <span class="total">{{ mov.total }} €</span>
              </div>
            </div>

            <div class="col-2">
              <ion-icon (click)="addVenta(mov.id, mov.acciones)" class="hand" style="font-size: 24px;color: green;" name="add-circle"></ion-icon>
            </div>
          </div>
          <div class="detail" *ngIf="selectedNode == mov">
            <div class="grid ventas">              
              <div class="col-3">
                <div class="text-center">{{ mov.fecha | date: 'dd/MM/yy' }}</div>
              </div>
              <div class="col-3">
                <div class="text-center">{{ mov.precio }}</div>
              </div>
              <div class="col-3">
                <div class="text-center">{{ mov.total }}</div>
              </div>
            </div> 
          </div>
        </div>
      </div>

      <!-- <p-table [value]="movimientos" [loading]="isLoading">
        <ng-template pTemplate="header">
          <tr>
            <th>A</th>
            <th>F</th>
            <th>P</th>
            <th>T</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-mov>
          <tr>
            <td class="col-3 hand" (click)="SelectedId=mov?.id">
              {{ mov.descripcion }}
            </td>
            <td>{{ mov.fecha | date: 'dd/MM/yy' }}</td>
            <td>{{ mov.precio }}</td>
            <td>{{ mov.total }}</td>
          </tr>
        </ng-template>
      </p-table> -->

      <!-- <p-tree [value]="movimientos" class="w-full md:w-30rem" [loading]="isLoading" 
      selectionMode="single"  [(selection)]="selectedNode"
      filterPlaceholder="filtrar por"  [filter]="true"   [style]="{'width': '100%;','border': 'solid 1px;'}"
       >
        <ng-template let-mov pTemplate="compra">


          
<div class="grid itemTreeCompra">
  <div class="col-3 hand" (click)="SelectedId==selectedNode?.data?.id">
    {{mov.label}}
  </div>
  <div class="col-3">
    {{mov.data.fecha | date: 'dd/MM/yy'}}
  </div>
  <div class="col-3">
    {{mov.data.precio}}
  </div>
  <div class="col-3">
    {{mov.data.total}}
  </div>
</div>





          <ion-grid  class="itemTreeCompra">
            <ion-row >
              <ion-col class="hand" (click)="SelectedId==selectedNode?.data?.id" size="4">{{mov.label}}</ion-col>
              <ion-col size="3">{{mov.data.fecha | date: 'dd/MM/yy'}}</ion-col>              
              <ion-col size="3">{{mov.data.precio}}</ion-col>
              <ion-col class="precioTotal" size="2">{{mov.data.total}}</ion-col>              
            </ion-row>            
            <ion-row *ngIf="mov==selectedNode">
              <ion-col><ion-icon  class="hand" style="font-size: 24px;color: green;" name="add-circle"></ion-icon></ion-col>
            </ion-row>         
          </ion-grid> 

        </ng-template>
      </p-tree> -->
    </ion-col>
  </ion-row>
</ion-grid>
