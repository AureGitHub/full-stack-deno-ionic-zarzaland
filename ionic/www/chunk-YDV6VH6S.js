import{$ as _,$b as K,B as b,Bb as D,Cb as P,E as d,F as r,G as t,H as m,Ib as V,Lb as B,Mc as X,Nb as G,O as c,Ob as j,Pb as $,Qb as R,Rb as U,Vb as z,Wb as H,Z as a,Zb as L,_ as v,_b as J,aa as C,cb as n,cc as Q,db as I,dc as W,eb as M,gb as x,hb as y,ib as A,jb as q,lb as E,nb as O,qa as F,s,v as g,va as S,vb as T,wb as w,x as f,xb as k,yb as N}from"./chunk-EENDQBIP.js";import{e as h}from"./chunk-JHI3MBHO.js";function Z(u,o){if(u&1&&(r(0,"ion-select-option",22),a(1),t()),u&2){let i=o.$implicit;d("value",i.id),s(),C(" ",i.id," - ",i.descripcion," ")}}var Y=class u{constructor(o,i,e){this.modalController=o;this.formBuilder=i;this.apiService=e}isEdit=!1;arriendo;arriendoForm;catastroOptions=[];showToast=!1;toastMessage="";toastColor="success";ngOnInit(){this.loadCatastroOptions(),this.createForm()}loadCatastroOptions(){this.apiService.get("/app-alquiler/catastro/").subscribe({next:o=>{let i=o.data??[];this.catastroOptions=i.map(e=>({id:e.catastroid??e.id??"",descripcion:e.direccion??""}))},error:o=>{console.error("Error cargando catastro:",o)}})}createForm(){let o="",i=2;if(this.isEdit&&this.arriendo){if(this.arriendo.fechapago){let e=new Date(this.arriendo.fechapago);isNaN(e.getTime())||(o=e.toISOString().slice(0,10))}i=this.arriendo.arriendotipoid??2,this.arriendoForm=this.formBuilder.group({catastroid:[this.arriendo.catastroid??"",[n.required]],arriendotipoid:[i,[n.required]],fechapago:[o,[n.required]],importe:[this.arriendo.importe??"",[n.required]],quien:[this.arriendo.quien??"",[n.required]],observaciones:[this.arriendo.observaciones??""]})}else if(this.arriendo&&this.arriendo.catastroid){i=this.arriendo.arriendotipoid??2;let e=new Date().toISOString().slice(0,10);this.arriendoForm=this.formBuilder.group({catastroid:[this.arriendo.catastroid,[n.required]],arriendotipoid:[i,[n.required]],fechapago:[e,[n.required]],importe:["",[n.required]],quien:["",[n.required]],observaciones:[""]})}else{let e=new Date().toISOString().slice(0,10);this.arriendoForm=this.formBuilder.group({catastroid:["",[n.required]],arriendotipoid:[2,[n.required]],fechapago:[e,[n.required]],importe:["",[n.required]],quien:["",[n.required]],observaciones:[""]})}}toggleArriendoTipo(o,i){if(i.detail.checked)this.arriendoForm.patchValue({arriendotipoid:o});else{let e=o===2?1:2;this.arriendoForm.get("arriendotipoid")?.value===e||this.arriendoForm.patchValue({arriendotipoid:null})}}onSubmit(){return h(this,null,function*(){if(this.arriendoForm.valid){let o=this.arriendoForm.value;(yield this.managementArriendo())&&(yield this.modalController.dismiss(o,"confirm"))}})}dismiss(){return h(this,null,function*(){yield this.modalController.dismiss(null,"cancel")})}showToastMessage(o,i="success"){this.toastMessage=o,this.toastColor=i,this.showToast=!0}managementArriendo(){return h(this,null,function*(){try{let o=this.arriendoForm.value;console.log("\u{1F4E1} Iniciando llamada POST...");let i=null;return this.isEdit?i=yield this.apiService.put(`/app-alquiler/arriendos/${this.arriendo?.id}`,o).toPromise():i=yield this.apiService.post("/app-alquiler/arriendos",o).toPromise(),i&&i.success&&i.data?(console.log("\u2705 Usuario gestionado exitosamente:",i.data),this.showToastMessage("Usuario creado exitosamente","success"),!0):(console.error("\u274C Error en respuesta del servidor:",i),this.showToastMessage("Error al crear usuario en el servidor","danger"),!1)}catch(o){return this.showToastMessage(`Error de conexi\xF3n: ${o}`,"danger"),!1}})}static \u0275fac=function(i){return new(i||u)(g(Q),g(E),g(X))};static \u0275cmp=f({type:u,selectors:[["app-arriendo-form-modal"]],inputs:{isEdit:"isEdit",arriendo:"arriendo"},decls:47,vars:11,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","catastroid","required","","interface","popover","placeholder","Selecciona un catastro"],[3,"value",4,"ngFor","ngForOf"],[2,"display","flex","gap","24px","margin-top","8px"],["color","primary",3,"ionChange","checked"],[1,"row-fields"],[1,"inline-item"],["formControlName","fechapago","type","date","required",""],["formControlName","importe","type","number","required",""],["formControlName","quien","required",""],["formControlName","observaciones"],[1,"button-container"],["expand","block","type","submit","color","primary",3,"disabled"],["name","save","slot","start"],["expand","block","fill","outline","color","medium",3,"click"],["name","close","slot","start"],["position","bottom",3,"didDismiss","isOpen","message","duration","color"],[3,"value"]],template:function(i,e){if(i&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a(3),t(),r(4,"ion-buttons",0)(5,"ion-button",1),c("click",function(){return e.dismiss()}),m(6,"ion-icon",2),t()()()(),r(7,"ion-content",3)(8,"form",4),c("ngSubmit",function(){return e.onSubmit()}),r(9,"ion-item")(10,"ion-label",5),a(11,"Propiedad *"),t(),r(12,"ion-select",6),b(13,Z,2,3,"ion-select-option",7),t()(),r(14,"ion-item")(15,"ion-label",5),a(16,"Tipo Arriendo *"),t(),r(17,"div",8)(18,"ion-checkbox",9),c("ionChange",function(p){return e.toggleArriendoTipo(2,p)}),a(19,"Anual"),t(),r(20,"ion-checkbox",9),c("ionChange",function(p){return e.toggleArriendoTipo(1,p)}),a(21,"Mensual"),t()()(),r(22,"div",10)(23,"ion-item",11)(24,"ion-label",5),a(25,"Fecha Pago *"),t(),m(26,"ion-input",12),t(),r(27,"ion-item",11)(28,"ion-label",5),a(29,"Importe *"),t(),m(30,"ion-input",13),t()(),r(31,"ion-item")(32,"ion-label",5),a(33,"Inquilino *"),t(),m(34,"ion-input",14),t(),r(35,"ion-item")(36,"ion-label",5),a(37,"Observaciones"),t(),m(38,"ion-input",15),t(),r(39,"div",16)(40,"ion-button",17),m(41,"ion-icon",18),a(42),t(),r(43,"ion-button",19),c("click",function(){return e.dismiss()}),m(44,"ion-icon",20),a(45," Cancelar "),t()()(),r(46,"ion-toast",21),c("didDismiss",function(){return e.showToast=!1}),t()()),i&2){let l,p;s(3),v(e.isEdit?"Editar Arriendo":"Nuevo Arriendo"),s(5),d("formGroup",e.arriendoForm),s(5),d("ngForOf",e.catastroOptions),s(5),d("checked",((l=e.arriendoForm.get("arriendotipoid"))==null?null:l.value)===2),s(2),d("checked",((p=e.arriendoForm.get("arriendotipoid"))==null?null:p.value)===1),s(20),d("disabled",!e.arriendoForm.valid),s(2),_(" ",e.isEdit?"Actualizar Arriendo":"Crear Arriendo"," "),s(4),d("isOpen",e.showToast)("message",e.toastMessage)("duration",3e3)("color",e.toastColor)}},dependencies:[S,F,O,x,I,M,q,y,A,W,D,P,V,B,G,j,$,R,U,z,H,L,J,K,T,w,k,N],styles:["[_nghost-%COMP%]     ion-content{overflow-y:auto!important;max-height:100%!important}.row-fields[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:12px}.inline-item[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;margin-bottom:0!important}[_nghost-%COMP%]     .modal-wrapper{width:420px!important;height:800px!important;min-height:400px!important;max-height:900px!important;margin-left:80px!important}.button-container[_ngcontent-%COMP%]{margin-top:24px;gap:12px;display:flex;flex-direction:column}ion-item[_ngcontent-%COMP%]{margin-bottom:12px}ion-label[_ngcontent-%COMP%]{font-weight:500}ion-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}"]})};export{Y as a};
