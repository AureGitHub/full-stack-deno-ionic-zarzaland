import{$ as I,Ab as A,B as x,Bb as R,Cb as D,Db as z,E as m,Eb as F,F as n,Fa as V,G as i,H as c,Jb as L,Kb as N,Lb as j,M as f,Mb as q,Nc as C,O as h,Ob as B,Oc as Z,P as u,Pc as ee,Qb as $,Rb as Q,S as y,Sb as H,T as O,U as S,Ub as G,Xb as W,Y as b,Z as o,_ as p,_b as J,aa as U,ac as K,cc as X,dc as Y,l as g,m as d,qa as E,ra as T,s as a,v as w,va as k,x as P}from"./chunk-EENDQBIP.js";import"./chunk-BNIJ3X2T.js";import"./chunk-TQJFVUNX.js";import"./chunk-XZGK7ZA7.js";import"./chunk-IPOTPHHM.js";import"./chunk-HXT7NW3W.js";import"./chunk-C7ZOD4DU.js";import"./chunk-EUTKHXLC.js";import"./chunk-KA7FWHEC.js";import"./chunk-CXNJJW2I.js";import"./chunk-CO3DYFKM.js";import"./chunk-RF7KNEQE.js";import"./chunk-J54ZEZCO.js";import"./chunk-HOU3Z2GS.js";import"./chunk-BYQAMOC3.js";import"./chunk-VXHG3QIR.js";import"./chunk-MTTA6DDO.js";import"./chunk-CNPXEUJC.js";import"./chunk-EMYUXUF4.js";import"./chunk-Y4PFSAAR.js";import"./chunk-TVOMSU7V.js";import"./chunk-2YWV2TBO.js";import"./chunk-GEK2GCCQ.js";import"./chunk-JZGUXWEV.js";import"./chunk-U7BNZF35.js";import"./chunk-7A6E5OXO.js";import"./chunk-WMMW5CXS.js";import{e as M}from"./chunk-JHI3MBHO.js";var ne=["authModal"];function ie(s,t){s&1&&(n(0,"div",27),c(1,"ion-spinner",28),n(2,"p"),o(3,"Cargando usuarios..."),i()())}function oe(s,t){if(s&1){let e=f();n(0,"ion-item",31)(1,"ion-avatar",32),c(2,"ion-icon",33),i(),n(3,"ion-label")(4,"h2"),o(5),i(),n(6,"h3"),o(7),i(),n(8,"p"),o(9),i(),n(10,"p"),o(11,"Rol: "),n(12,"span",34),o(13),i()()(),n(14,"ion-chip",35),o(15),i(),n(16,"ion-buttons",36)(17,"ion-button",37),h("click",function(){let l=g(e).$implicit,_=u(3);return d(_.editUser(l))}),c(18,"ion-icon",38),i(),n(19,"ion-button",39),h("click",function(){let l=g(e).$implicit,_=u(3);return d(_.deleteUser(l))}),c(20,"ion-icon",40),i()()()}if(s&2){let e=t.$implicit;a(5),p(e.username),a(2),p(e.email),a(2),U("",e.first_name," ",e.last_name),a(3),b("role-"+e.profile_id),a(),p(e.profile_id),a(),m("color",e.is_active?"success":"medium"),a(),I(" ",e.is_active?"Activo":"Inactivo"," ")}}function re(s,t){if(s&1&&(n(0,"ion-list",29),x(1,oe,21,9,"ion-item",30),i()),s&2){let e=u(2);a(),m("ngForOf",e.users)("ngForTrackBy",e.trackUser)}}function ae(s,t){if(s&1){let e=f();n(0,"div",41),c(1,"ion-icon",42),n(2,"h3"),o(3,"No hay usuarios"),i(),n(4,"p"),o(5,"No se encontraron usuarios en el sistema"),i(),n(6,"ion-button",21),h("click",function(){g(e);let l=u(2);return d(l.refreshUsers())}),c(7,"ion-icon",22),o(8," Recargar "),i()()}}function se(s,t){if(s&1){let e=f();n(0,"div",43),c(1,"ion-icon",44),n(2,"h3"),o(3,"Error al cargar datos"),i(),n(4,"p"),o(5),i(),n(6,"ion-button",21),h("click",function(){g(e);let l=u(2);return d(l.refreshUsers())}),c(7,"ion-icon",22),o(8," Reintentar "),i()()}if(s&2){let e=u(2);a(5),p(e.error)}}function le(s,t){if(s&1){let e=f();n(0,"ion-content",6)(1,"div",7)(2,"div",8),c(3,"ion-icon",9),n(4,"h1"),o(5,"Gesti\xF3n de Usuarios"),i(),n(6,"p"),o(7,"Panel de administraci\xF3n para la gesti\xF3n completa de usuarios del sistema"),i()()(),n(8,"div",10)(9,"ion-grid")(10,"ion-row")(11,"ion-col",11)(12,"ion-card",12)(13,"ion-card-content")(14,"div",13),c(15,"ion-icon",14),n(16,"div",15)(17,"h2"),o(18),i(),n(19,"p"),o(20,"Total Usuarios"),i()()()()()(),n(21,"ion-col",11)(22,"ion-card",12)(23,"ion-card-content")(24,"div",13),c(25,"ion-icon",16),n(26,"div",15)(27,"h2"),o(28),i(),n(29,"p"),o(30,"Activos"),i()()()()()(),n(31,"ion-col",11)(32,"ion-card",12)(33,"ion-card-content")(34,"div",13),c(35,"ion-icon",17),n(36,"div",15)(37,"h2"),o(38),i(),n(39,"p"),o(40,"Propietarios"),i()()()()()(),n(41,"ion-col",11)(42,"ion-card",12)(43,"ion-card-content")(44,"div",13),c(45,"ion-icon",18),n(46,"div",15)(47,"h2"),o(48),i(),n(49,"p"),o(50,"Inquilinos"),i()()()()()()()()(),n(51,"div",19)(52,"div",20)(53,"h2"),o(54,"Lista de Usuarios"),i(),n(55,"ion-button",21),h("click",function(){g(e);let l=u();return d(l.refreshUsers())}),c(56,"ion-icon",22),o(57," Actualizar "),i()(),x(58,ie,4,0,"div",23)(59,re,2,2,"ion-list",24)(60,ae,9,0,"div",25),i(),x(61,se,9,1,"div",26),i()}if(s&2){let e=u();a(18),p(e.totalUsers),a(10),p(e.activeUsers),a(10),p(e.propertyOwners),a(10),p(e.tenants),a(10),m("ngIf",e.loading),a(),m("ngIf",!e.loading&&e.users.length>0),a(),m("ngIf",!e.loading&&e.users.length===0),a(),m("ngIf",e.error)}}function ce(s,t){s&1&&(n(0,"div",45),c(1,"ion-spinner",28),n(2,"p"),o(3,"Verificando autenticaci\xF3n..."),i()())}var te=class s{constructor(t,e,r){this.authService=t;this.router=e;this.modalController=r}authModal;isAuthenticated=!1;showAuthModal=!1;authSubscription;authConfig={showLogo:!1,title:"Acceso Requerido",subtitle:"Necesitas iniciar sesi\xF3n para acceder a la gesti\xF3n de usuarios",color:"primary",allowRegistration:!1,allowForgotPassword:!1,allowRememberMe:!0,minPasswordLength:6};users=[];loading=!1;error=null;totalUsers=0;activeUsers=0;propertyOwners=0;tenants=0;showToast=!1;toastMessage="";toastColor="success";ngOnInit(){this.checkAuthentication()}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}checkAuthentication(){this.authSubscription=this.authService.isLogin$.subscribe(t=>{this.isAuthenticated=t,t?(this.showAuthModal=!1,this.loadUsers()):setTimeout(()=>{this.showAuthModal=!0},500)})}loadUsers(){return M(this,null,function*(){this.loading=!0,this.error=null;try{yield new Promise(t=>setTimeout(t,800)),this.users=[],this.updateStats(),this.showToastMessage("Usuarios cargados correctamente","success")}catch(t){this.error=t.friendlyMessage||"Error al cargar los usuarios. Por favor, int\xE9ntalo de nuevo.",this.showToastMessage("Error al cargar usuarios","danger"),console.error("Error loading users:",t)}finally{this.loading=!1}})}updateStats(){this.totalUsers=this.users.length,this.activeUsers=this.users.filter(t=>t.is_active).length,this.propertyOwners=this.users.filter(t=>t.profile_id===C.owner).length,this.tenants=this.users.filter(t=>t.profile_id===C.tenant).length}onLogin(t){return M(this,null,function*(){try{let e={email:t.email,password:t.password};this.authService.loginWithCredentials(e).subscribe({next:r=>{r?this.showToastMessage("Inicio de sesi\xF3n exitoso","success"):this.showToastMessage("Credenciales inv\xE1lidas","danger")},error:r=>{this.showToastMessage(r.message||"Error en el inicio de sesi\xF3n","danger"),console.error("Login error:",r)}})}catch(e){this.showToastMessage("Error en el inicio de sesi\xF3n","danger"),console.error("Login error:",e)}})}onRegister(t){return M(this,null,function*(){console.log("Register:",t)})}onForgotPassword(t){return M(this,null,function*(){console.log("Forgot password:",t)})}onAuthClose(){this.goHome()}goHome(){this.router.navigate(["/home"])}logout(){this.authService.logout(),this.showToastMessage("Sesi\xF3n cerrada","success"),this.goHome()}refreshUsers(){this.loadUsers()}editUser(t){this.showToastMessage(`Editando usuario: ${t.username}`,"warning"),console.log("Edit user:",t)}deleteUser(t){this.showToastMessage(`Usuario eliminado: ${t.username}`,"danger"),console.log("Delete user:",t),this.users=this.users.filter(e=>e.id!==t.id),this.updateStats()}trackUser(t,e){return e.id}showToastMessage(t,e="success"){this.toastMessage=t,this.toastColor=e,this.showToast=!0}static \u0275fac=function(e){return new(e||s)(w(Z),w(V),w(X))};static \u0275cmp=P({type:s,selectors:[["app-user-management"]],viewQuery:function(e,r){if(e&1&&y(ne,5),e&2){let l;O(l=S())&&(r.authModal=l.first)}},decls:6,vars:10,consts:[["authModal",""],[3,"isOpen","canDismiss","backdropDismiss"],[3,"login","register","forgotPassword","close","config"],["class","user-management-content",4,"ngIf"],["class","initial-loading",4,"ngIf"],["position","bottom",3,"didDismiss","isOpen","message","duration","color"],[1,"user-management-content"],[1,"welcome-section"],[1,"welcome-content"],["name","people-outline",1,"welcome-icon"],[1,"stats-section"],["size","12","size-sm","6","size-md","3"],[1,"stat-card"],[1,"stat-content"],["name","people","color","primary",1,"stat-icon"],[1,"stat-info"],["name","checkmark-circle","color","success",1,"stat-icon"],["name","home","color","warning",1,"stat-icon"],["name","key","color","tertiary",1,"stat-icon"],[1,"users-section"],[1,"section-header"],["color","primary",3,"click"],["name","refresh","slot","start"],["class","loading-container",4,"ngIf"],["lines","full",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","error-state",4,"ngIf"],[1,"loading-container"],["name","circular"],["lines","full"],["class","user-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"user-item"],["slot","start"],["name","person-circle-outline",1,"avatar-icon"],[1,"user-role"],["slot","end",1,"status-chip",3,"color"],["slot","end"],["fill","clear",3,"click"],["name","pencil","slot","icon-only"],["fill","clear","color","danger",3,"click"],["name","trash","slot","icon-only"],[1,"empty-state"],["name","people-outline",1,"empty-icon"],[1,"error-state"],["name","alert-circle-outline","color","danger",1,"error-icon"],[1,"initial-loading"]],template:function(e,r){if(e&1){let l=f();n(0,"ion-modal",1,0)(2,"lib-auth",2),h("login",function(v){return g(l),d(r.onLogin(v))})("register",function(v){return g(l),d(r.onRegister(v))})("forgotPassword",function(v){return g(l),d(r.onForgotPassword(v))})("close",function(){return g(l),d(r.onAuthClose())}),i()(),x(3,le,62,8,"ion-content",3)(4,ce,4,0,"div",4),n(5,"ion-toast",5),h("didDismiss",function(){return g(l),d(r.showToast=!1)}),i()}e&2&&(m("isOpen",r.showAuthModal)("canDismiss",!1)("backdropDismiss",!1),a(2),m("config",r.authConfig),a(),m("ngIf",r.isAuthenticated),a(),m("ngIf",!r.isAuthenticated&&!r.showAuthModal),a(),m("isOpen",r.showToast)("message",r.toastMessage)("duration",3e3)("color",r.toastColor))},dependencies:[k,E,T,Y,A,R,D,z,F,L,N,j,q,B,$,Q,H,G,W,J,K,ee],styles:[".user-management-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.welcome-section[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;background:linear-gradient(135deg,var(--ion-color-primary) 0%,var(--ion-color-secondary) 100%);color:#fff}.welcome-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin:16px 0 8px}.welcome-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{opacity:.9;font-size:1.1rem}.welcome-icon[_ngcontent-%COMP%]{font-size:3rem;color:#fff}.stats-section[_ngcontent-%COMP%]{padding:20px;background:#fff}.stat-card[_ngcontent-%COMP%]{margin:0;border-radius:12px;box-shadow:0 2px 8px #0000001a}.stat-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.stat-icon[_ngcontent-%COMP%]{font-size:2.5rem}.stat-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin:0;color:var(--ion-color-dark)}.stat-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--ion-color-medium);font-size:.9rem}.users-section[_ngcontent-%COMP%]{padding:20px}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--ion-color-dark);margin:0}.user-item[_ngcontent-%COMP%]{--background: white;margin-bottom:8px;border-radius:12px;box-shadow:0 2px 8px #0000000d}.avatar-icon[_ngcontent-%COMP%]{font-size:2rem;color:var(--ion-color-medium)}.user-role[_ngcontent-%COMP%]{font-weight:600;text-transform:capitalize}.role-1[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.role-2[_ngcontent-%COMP%]{color:var(--ion-color-warning)}.role-3[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}.role-user[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.status-chip[_ngcontent-%COMP%]{font-size:.8rem}.loading-container[_ngcontent-%COMP%], .initial-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .initial-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-icon[_ngcontent-%COMP%], .error-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:20px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-dark);margin-bottom:8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:20px}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}.welcome-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}}"]})};export{te as UserManagementPage};
