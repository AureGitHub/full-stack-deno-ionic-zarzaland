import{a as w}from"./chunk-YDV6VH6S.js";import"./chunk-D7YIWJQY.js";import{a as U}from"./chunk-KJEV6NA2.js";import{B as _,Bb as D,Db as E,E as l,Eb as S,F as o,G as a,Gc as K,H as b,Lb as V,Lc as R,M as A,Mc as $,O as g,Ob as B,P as d,Xb as G,Z as p,_ as x,_b as k,ba as v,bc as F,cc as N,dc as z,ec as j,ga as M,ha as P,l as u,m,oa as T,ra as q,s,sa as y,v as c,va as I,x as C,zb as O}from"./chunk-EENDQBIP.js";import"./chunk-BNIJ3X2T.js";import"./chunk-TQJFVUNX.js";import"./chunk-XZGK7ZA7.js";import"./chunk-IPOTPHHM.js";import"./chunk-HXT7NW3W.js";import"./chunk-C7ZOD4DU.js";import"./chunk-EUTKHXLC.js";import"./chunk-KA7FWHEC.js";import"./chunk-CXNJJW2I.js";import"./chunk-CO3DYFKM.js";import"./chunk-RF7KNEQE.js";import"./chunk-J54ZEZCO.js";import"./chunk-HOU3Z2GS.js";import"./chunk-BYQAMOC3.js";import"./chunk-VXHG3QIR.js";import"./chunk-MTTA6DDO.js";import"./chunk-CNPXEUJC.js";import"./chunk-EMYUXUF4.js";import"./chunk-Y4PFSAAR.js";import"./chunk-TVOMSU7V.js";import"./chunk-2YWV2TBO.js";import"./chunk-GEK2GCCQ.js";import"./chunk-JZGUXWEV.js";import"./chunk-U7BNZF35.js";import"./chunk-7A6E5OXO.js";import"./chunk-WMMW5CXS.js";import{e as f}from"./chunk-JHI3MBHO.js";function W(i,e){i&1&&(o(0,"div",7),b(1,"ion-spinner",8),o(2,"p"),p(3,"Cargando alquileres..."),a()())}function J(i,e){if(i&1){let t=A();o(0,"ion-card",9)(1,"ion-card-content"),b(2,"ion-icon",10),o(3,"h3"),p(4,"Error al cargar alquileres"),a(),o(5,"p"),p(6),a(),o(7,"ion-button",11),g("click",function(){u(t);let n=d();return m(n.loadArriendos())}),p(8,"Reintentar"),a()()()}if(i&2){let t=d();s(6),x(t.error)}}function L(i,e){if(i&1){let t=A();o(0,"shared-table",15),g("add",function(){u(t);let n=d(2);return m(n.onAddArriendo())})("edit",function(n){u(t);let h=d(2);return m(h.onEditArriendo(n))})("delete",function(n){u(t);let h=d(2);return m(h.onDeleteArriendo(n))}),a()}if(i&2){let t=d(2);l("data",t.arriendos)("columns",t.tableColumns)("config",t.tableConfig)("showToolbar",!0)("showCaption",!0)("showActions",!0)("showAddButton",!0)("showEditButton",!0)("showDeleteButton",!0)("showExportButton",!1)}}function Q(i,e){if(i&1&&(o(0,"div",12),_(1,L,1,10,"shared-table",13),o(2,"p",14),p(3),M(4,"date"),a()()),i&2){let t=d();s(),l("ngIf",t.tableKey>0),s(2),v(" \xDAltima actualizaci\xF3n: ",P(4,4,t.lastUpdate,"HH:mm:ss")," | Alquileres: ",t.arriendos.length," | Table Key: ",t.tableKey," ")}}var H=class i{constructor(e,t,r,n,h){this.apiService=e;this.cdr=t;this.pageTitleService=r;this.alertController=n;this.modalController=h}arriendos=[];loading=!1;error=null;lastUpdate=new Date;tableKey=0;showToast=!1;toastMessage="";toastColor="success";showAlert=!1;alertMessage="";alertButtons=[];tableColumns=[{field:"direccion",header:"direccion",sortable:!0,filterable:!0},{field:"arriendotipoid",header:"Tipo",sortable:!0,type:"text",width:"120px",displayFn:e=>e.arriendotipoid===1?"Mensual":e.arriendotipoid===2?"Anual":""},{field:"fechapago",header:"F.Pago",sortable:!0,type:"date",width:"150px"},{field:"importe",header:"Importe",sortable:!0,type:"number"},{field:"quien",header:"Inquilino",sortable:!0,filterable:!0},{field:"observaciones",header:"Obser.",filterable:!0}];tableConfig={paginator:!0,rows:10,rowsPerPageOptions:[5,10,25,50],selectionMode:"multiple",showCurrentPageReport:!0,globalFilterFields:["catastroid","quien","observaciones"]};ngOnInit(){j({save:K}),this.pageTitleService.setTitle("Gesti\xF3n de Alquileres"),this.tableKey=1,this.loadArriendos()}loadArriendos(){this.loading=!0,this.error=null,this.apiService.get("/app-alquiler/arriendos").subscribe({next:e=>{console.log("loadArriendos...",e),e.success&&Array.isArray(e.data)?this.arriendos=[...e.data]:this.arriendos=[],this.lastUpdate=new Date,this.loading=!1,this.cdr.markForCheck()},error:e=>{this.error=e.message||"Error al cargar alquileres",this.loading=!1,this.cdr.markForCheck()}})}onAddArriendo(){this.openAddArriendoModal()}openAddArriendoModal(){return f(this,null,function*(){let e=yield this.modalController.create({component:w,componentProps:{isEdit:!1}});yield e.present();let{data:t,role:r}=yield e.onWillDismiss();r==="confirm"&&t&&this.loadArriendos()})}createArriendo(e){this.apiService.post("/app-alquiler/arriendo",e).subscribe({next:t=>{t.success&&t.data?(this.showToastMessage("Arriendo creado correctamente","success"),this.loadArriendos()):this.showToastMessage("No se pudo crear el arriendo","danger")},error:()=>{this.showToastMessage("Error al crear el arriendo","danger")}})}onEditArriendo(e){this.openEditArriendoModal(e)}openEditArriendoModal(e){return f(this,null,function*(){let t=yield this.modalController.create({component:w,componentProps:{isEdit:!0,arriendo:e}});yield t.present();let{data:r,role:n}=yield t.onWillDismiss();n==="confirm"&&r&&this.loadArriendos()})}updateArriendo(e,t){this.apiService.put(`/app-alquiler/arriendo/${e}`,t).subscribe({next:r=>{r.success&&r.data?(this.showToastMessage("Arriendo actualizado correctamente","success"),this.loadArriendos()):this.showToastMessage("No se pudo actualizar el arriendo","danger")},error:()=>{this.showToastMessage("Error al actualizar el arriendo","danger")}})}onDeleteArriendo(e){this.confirmDeleteArriendo(e)}confirmDeleteArriendo(e){return f(this,null,function*(){yield(yield this.alertController.create({header:"Eliminar Arriendo",message:`\xBFSeguro que quieres eliminar el arriendo de <b>${e.quien}</b> (ID: ${e.id})?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"confirm",handler:()=>this.deleteArriendo(e.id)}]})).present()})}deleteArriendo(e){this.apiService.delete(`/app-alquiler/arriendos/${e}`).subscribe({next:t=>{t.success?(this.showToastMessage("Arriendo eliminado correctamente","success"),this.loadArriendos()):this.showToastMessage("No se pudo eliminar el arriendo","danger")},error:()=>{this.showToastMessage("Error al eliminar el arriendo","danger")}})}showToastMessage(e,t="success"){this.toastMessage=e,this.toastColor=t,this.showToast=!0}static \u0275fac=function(t){return new(t||i)(c($),c(T),c(U),c(F),c(N))};static \u0275cmp=C({type:i,selectors:[["app-ver-gestion-alquiler"]],decls:7,vars:11,consts:[[1,"ver-gestion-alquiler-content",3,"fullscreen"],[1,"table-section"],["class","loading-container",4,"ngIf"],["class","error-card",4,"ngIf"],["class","table-wrapper",4,"ngIf"],["position","bottom",3,"didDismiss","isOpen","message","duration","color"],["header","Confirmar Acci\xF3n",3,"didDismiss","isOpen","message","buttons"],[1,"loading-container"],["name","crescent"],[1,"error-card"],["name","alert-circle-outline","color","danger"],["fill","outline","color","primary",3,"click"],[1,"table-wrapper"],["title","Alquileres","emptyMessage","No hay alquileres registrados",3,"data","columns","config","showToolbar","showCaption","showActions","showAddButton","showEditButton","showDeleteButton","showExportButton","add","edit","delete",4,"ngIf"],[1,"debug-info"],["title","Alquileres","emptyMessage","No hay alquileres registrados",3,"add","edit","delete","data","columns","config","showToolbar","showCaption","showActions","showAddButton","showEditButton","showDeleteButton","showExportButton"]],template:function(t,r){t&1&&(o(0,"ion-content",0)(1,"div",1),_(2,W,4,0,"div",2)(3,J,9,1,"ion-card",3)(4,Q,5,7,"div",4),a(),o(5,"ion-toast",5),g("didDismiss",function(){return r.showToast=!1}),a(),o(6,"ion-alert",6),g("didDismiss",function(){return r.showAlert=!1}),a()()),t&2&&(l("fullscreen",!0),s(2),l("ngIf",r.loading),s(),l("ngIf",r.error&&!r.loading),s(),l("ngIf",!r.loading&&!r.error),s(),l("isOpen",r.showToast)("message",r.toastMessage)("duration",3e3)("color",r.toastColor),s(),l("isOpen",r.showAlert)("message",r.alertMessage)("buttons",r.alertButtons))},dependencies:[I,q,z,O,D,E,S,V,B,G,k,R,y],styles:[".ver-gestion-alquiler-content[_ngcontent-%COMP%]{background:var(--ion-color-light);padding:20px}.table-section[_ngcontent-%COMP%]{padding:20px 20px 40px;max-width:1200px;margin:0 auto}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:40px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #00000014}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0}.error-card[_ngcontent-%COMP%]{text-align:center;border-radius:12px;box-shadow:0 2px 8px #00000014}.error-card[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:16px}.error-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-danger);margin-bottom:8px}.error-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:20px}.table-wrapper[_ngcontent-%COMP%]{width:100%;background:#fff;border-radius:12px;box-shadow:0 2px 8px #00000014;padding:16px;margin-bottom:40px}.debug-info[_ngcontent-%COMP%]{text-align:center;color:var(--ion-color-medium);font-size:.8rem;margin-top:16px;font-style:italic}@media (max-width: 768px){.table-section[_ngcontent-%COMP%]{padding-bottom:60px}}"]})};export{H as VerGestionAlquilerPage};
